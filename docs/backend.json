{
  "entities": {
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a financial transaction, either income or expense.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction. Positive for income, negative for expense."
        },
        "title": {
          "type": "string",
          "description": "A descriptive title for the transaction."
        },
        "category": {
          "type": "string",
          "description": "The category to which the transaction belongs (e.g., 'Food', 'Salary')."
        },
        "date": {
          "type": "string",
          "description": "The date of the transaction.",
          "format": "date-time"
        },
        "installmentGroupId": {
          "type": "string",
          "description": "Identifier for grouping transactions related to the same installment purchase. Null if not an installment."
        }
      },
      "required": [
        "id",
        "amount",
        "title",
        "category",
        "date"
      ]
    },
    "CreditCard": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CreditCard",
      "type": "object",
      "description": "Represents a credit card with its associated details.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the credit card."
        },
        "name": {
          "type": "string",
          "description": "The name of the credit card (e.g., 'Visa', 'Mastercard')."
        },
        "limit": {
          "type": "number",
          "description": "The credit limit of the card."
        }
      },
      "required": [
        "id",
        "name",
        "limit"
      ]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents user-specific preferences and settings related to AI finance personalities.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "aiPersonality": {
          "type": "string",
          "description": "The selected AI finance personality for the user."
        }
      },
      "required": [
        "id",
        "aiPersonality"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Stores financial transaction data for a specific user. Path-based ownership ensures that only the authenticated user can access their own transactions.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier of the transaction."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cards/{cardId}",
        "definition": {
          "entityName": "CreditCard",
          "schema": {
            "$ref": "#/backend/entities/CreditCard"
          },
          "description": "Stores credit card details for a specific user. Path-based ownership ensures that only the authenticated user can access their own credit card information.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "cardId",
              "description": "The unique identifier of the credit card."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile data including AI personality preferences. Path-based ownership ensures that only the authenticated user can access their own profile information.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to persist transaction and credit card data for the Luumos Financial AI application. The structure prioritizes security and scalability by adhering to the principles of Authorization Independence, Structural Segregation, and Access Modeling. Each user has their own collection of transactions and credit cards to ensure data privacy. User profile data, including AI personality preferences, is stored in a separate collection. This structure will support performant `list` operations because of the path-based ownership and lack of `get()` calls in security rules.\n\n*   **Authorization Independence:** Transactions and credit cards are stored under the `/users/{userId}` path, eliminating the need for `get()` calls to verify ownership.\n*   **Structural Segregation:**  Transactions and credit cards are kept in separate collections, each with its own security posture.\n*   **Access Modeling:** The structure uses path-based ownership (`/users/{userId}/transactions/{transactionId}`) for private data, allowing for simple and robust security rules based on `request.auth.uid`."
  }
}